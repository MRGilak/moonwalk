---
layout: default
---

<article class="note">
  <header style="position: relative;">
    <a href="{{ "/" | relative_url }}">{{ site.theme_config.back_home_text }}</a>
    <h1>{{ page.title }}</h1>
    <p class="meta">{{ page.date | date: "%B %d, %Y" }}</p>

    <!-- Top-right note about AI summary -->
    <div style="position: absolute; top: 0; right: 0; font-size: 1.1rem; color: #555;">
      AI summary available at the end of the page
    </div>
  </header>

  <div class="content">
    {{ content }}
  </div>

  {% if page.backlinks %}
  <div class="backlinks">
    <h3>Links to this note</h3>
    <ul>
      {% for backlink in page.backlinks %}
      <li><a href="{{ backlink.url }}">{{ backlink.title }}</a></li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <!-- AI Summary Button -->
  <div class="ai-summary-container" style="margin: 2rem 0;">
    <button id="ai-summary-btn">Click to get AI summary</button>
    <div id="ai-summary-result"></div>
  </div>
</article>

<style>
  #ai-summary-btn {
    background-color: #4CAF50;
    color: white;
    border: none;
    border-radius: 12px;
    padding: 12px 24px;
    font-size: 16px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #ai-summary-btn:hover { background-color: #45a049; }
  #ai-summary-result {
    background-color: #f9f9f9;
    border-left: 4px solid #4CAF50;
    padding: 12px;
    margin-top: 1rem;
    border-radius: 6px;
    font-style: italic;
  }
</style>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("ai-summary-btn");
  const resultDiv = document.getElementById("ai-summary-result");

  if (!btn) return;

  btn.addEventListener("click", async () => {
    btn.disabled = true;
    btn.textContent = "Generating summary...";
    resultDiv.textContent = "";

    try {
      // Determine function base. If hosted on Netlify, /.netlify/functions works.
      // If hosted on GitHub Pages (with a subpath), the function must be absolute via your Netlify site URL.
      // You can set window.NETLIFY_FUNCTIONS_BASE in _includes/custom_head.html to override when needed.
      const base = window.NETLIFY_FUNCTIONS_BASE || "";
      const fnUrl = (base ? base.replace(/\/$/, "") : "") + "/.netlify/functions/summarize";

      const response = await fetch(fnUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          text: document.querySelector(".content").innerText
        }),
      });

      const data = await response.json();

      if (response.ok && data.summary) {
        resultDiv.textContent = data.summary;
      } else {
        resultDiv.textContent = "Error generating summary: " + (data.error || "Unknown");
        console.error("AI summary error", { status: response.status, data });
      }
    } catch (err) {
      console.error(err);
      resultDiv.textContent = "Error generating summary.";
    } finally {
      btn.disabled = false;
      btn.textContent = "Click to get AI summary";
    }
  });
});
</script>
