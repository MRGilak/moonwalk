<!DOCTYPE html>
<html lang="{{ page.lang | default: "en" }}" class="html" data-theme="{{ site.theme_config.appearance | default: "auto" }}">
  {%- include head.html -%}
  <body>
    <!-- Page content wrapper (no parallax here) -->
    <main class="page-content" aria-label="Content">
      <div class="w">
        {{ content }}
        {% if site.theme_config.appearance_toggle %}
          {% include toggle_theme_button.html %}
        {% endif %}
        <div class="credits">
          &copy; {{ "now" | date: "%Y" }} Mohammadreza Gilak
        </div>
      </div>
    </main>

    <!-- Only load parallax script on home page -->
    {% if page.layout == "home" %}
      <script src="{{ '/assets/js/parallax.js' | relative_url }}"></script>
    {% endif %}

    <style>
      #ai-summary-btn {
        background-color: #4CAF50; /* green */
        color: white;
        border: none;
        border-radius: 12px;        /* rounded corners */
        padding: 12px 24px;         /* bigger than default */
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      #ai-summary-btn:hover {
        background-color: #45a049;  /* slightly darker green on hover */
      }

      #ai-summary-result {
        background-color: #f9f9f9;
        border-left: 4px solid #4CAF50;
        padding: 12px;
        margin-top: 1rem;
        border-radius: 6px;
        font-style: italic;
      }
    </style>


    <script>
      // Global fallback: convert literal fenced code (``` ... ```) into <pre><code> blocks
      (function(){
        function renderFencedCode(container) {
          if (!container) return;
          if (container.getAttribute('data-fences-processed') === 'true') return;
          const blocks = Array.from(container.querySelectorAll('p, li, blockquote'));
          for (const p of blocks) {
            const text = p.textContent || '';
            if (!text.includes('```')) continue;
            const lines = text.split(/\r?\n/);
            const frag = document.createDocumentFragment();
            let inCode = false;
            let codeLang = '';
            let codeLines = [];
            let transformed = false;
            for (const line of lines) {
              const fence = line.match(/^```(.*)$/);
              if (fence) {
                if (!inCode) {
                  inCode = true;
                  transformed = true;
                  const info = (fence[1] || '').trim();
                  codeLang = (info.split(/\s+/)[0] || '').toLowerCase();
                  codeLines = [];
                } else {
                  inCode = false;
                  const pre = document.createElement('pre');
                  pre.className = 'highlight';
                  const code = document.createElement('code');
                  code.className = (codeLang ? `language-${codeLang} ` : '') + 'highlighter-rouge';
                  code.textContent = codeLines.join('\n');
                  pre.appendChild(code);
                  frag.appendChild(pre);
                  codeLang = '';
                  codeLines = [];
                }
                continue;
              }
              if (inCode) {
                codeLines.push(line);
              } else {
                frag.appendChild(document.createTextNode(line));
                frag.appendChild(document.createElement('br'));
              }
            }
            if (transformed) {
              const wrapper = document.createElement('div');
              wrapper.appendChild(frag);
              p.replaceWith(wrapper);
            }
          }
          container.setAttribute('data-fences-processed', 'true');
        }
        document.addEventListener('DOMContentLoaded', function(){
          const content = document.querySelector('.content');
          if (content) renderFencedCode(content);
        });
      })();
    </script>

  </body>
</html>
